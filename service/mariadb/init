MARIADB_USER=${MARIADB_USER:-"docker"}
MARIADB_PASS=${MARIADB_PASS:-"docker"}
MARIADB_DB=${MARIADB_DB:-""}
chown -R mysql /data
if [ ! "$(ls -A /data)" ]; then
	cp -R /var/lib/mysql/* /data
	mysqld_safe --background --skip-grant-tables
	while [ ! -e /run/mysqld/mysqld.sock ]; do
		inotifywait -e create -q /run/mysqld/
	done
	mysql -u root -e "CREATE USER '$MARIADB_USER'@'%' IDENTIFIED BY '$MARIADB_PASS';"
	mysql -u root -e "GRANT ALL PRIVILEGES ON *.* TO '$MARIADB_USER'@'%' WITH GRANT OPTION;"
	if [ $MARIADB_DB != "" ]; then
		mysql -u root -e "CREATE DATABASE $MARIADB_DB;"
	fi
	mysqladmin -u root shutdown
fi
